#!/usr/bin/env bash

function escape_dot(){
    echo "$1" | sed 's|\.|\\\.|g'
}

branch=$(git describe --contains --all HEAD 2> /dev/null);
if [ $? -ne 0 ]; then
    exit
fi

if git rev-parse --abbrev-ref --symbolic-full-name @{upstream} 2> /dev/null; then
    ahead=$(git rev-list --left-only --count $(escape_dot $branch)...@{upstream} 2> /dev/null);
    if [ ! -z "$ahead" ] && [ "$ahead" -ne 0 ]; then
        echo -n "+$ahead "
    fi
    behind=$(git rev-list --right-only --count $(escape_dot $branch)...@{upstream} 2> /dev/null);
    if [ ! -z "$behind" ] && [ "$behind" -ne 0 ]; then
        echo -n "-$behind "
    fi
fi

echo -n $branch

if [ -z "$(git status --porcelain)" ]; then
    echo -n " "
else
    echo -n "* "
fi
