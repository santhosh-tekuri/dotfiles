#!/usr/bin/env bash

function escape_dot(){
    echo "$1" | sed 's|\.|\\\.|g'
}

branch=$(git describe --contains --all HEAD 2> /dev/null);
if [ $? -ne 0 ]; then
    exit
fi

if git rev-parse --abbrev-ref --symbolic-full-name @{upstream} &> /dev/null; then
    count=$(git rev-list --left-right --count $(escape_dot $branch)...@{upstream});
    ahead=$(printf %s "$count" | cut -d $'\t' -f1)
    behind=$(printf %s "$count" | cut -d $'\t' -f2)
    if [ "$ahead" -ne 0 ]; then
        echo -n "+$ahead "
    fi
    if [ "$behind" -ne 0 ]; then
        echo -n "-$behind "
    fi
fi

echo -n $branch

if [ -z "$(git status --porcelain)" ]; then
    echo -n " "
else
    echo -n "* "
fi
